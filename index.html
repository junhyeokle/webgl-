<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GLB Loader</title>
  <style>
    html,body { margin:0; height:100%; overflow:hidden; background:#0e0f11; }
    canvas { width:100%; height:100%; display:block; }
  </style>
</head>
<body>
<canvas id="c"></canvas>

<script type="module">
  import * as THREE from 'https://unpkg.com/three@0.165.0/build/three.module.js';
  import { OrbitControls } from 'https://unpkg.com/three@0.165.0/examples/jsm/controls/OrbitControls.js';
  import { GLTFLoader } from 'https://unpkg.com/three@0.165.0/examples/jsm/loaders/GLTFLoader.js';

  // 기본 셋업
  const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('c'), antialias:true });
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.outputColorSpace = THREE.SRGBColorSpace;
  renderer.toneMapping = THREE.ACESFilmicToneMapping;

  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x0e0f11);

  const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.01, 5000);
  camera.position.set(2.5, 1.6, 2.5);

  const controls = new OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;

  // 라이트
  scene.add(new THREE.AmbientLight(0xffffff, 0.9));
  const dir = new THREE.DirectionalLight(0xffffff, 0.8);
  dir.position.set(5, 10, 6);
  scene.add(dir);

  // 로더
  const loader = new GLTFLoader();
  const url = './assets/wraith.glb?v=' + Date.now(); // 캐시 무효화

  loader.load(url, (glb) => {
    const model = glb.scene;
    model.scale.set(0.02, 0.02, 0.02);   // 네가 준 스케일 유지
    model.traverse(o => {                // 면 뒤집힘 대비
      if (o.isMesh && o.material) o.material.side = THREE.DoubleSide;
    });
    scene.add(model);

    // ▲ 로드 후 카메라 프레이밍(여기가 제일 중요!)
    const box = new THREE.Box3().setFromObject(model);
    const size = box.getSize(new THREE.Vector3());
    const center = box.getCenter(new THREE.Vector3());
    const maxDim = Math.max(size.x, size.y, size.z) || 1;

    controls.target.copy(center);
    const fov = camera.fov * Math.PI/180;
    let dist = (maxDim/2) / Math.tan(fov/2);
    dist *= 1.4; // 여유
    camera.position.copy(center).add(new THREE.Vector3(dist, dist*0.4, dist));
    camera.near = Math.max(0.01, maxDim/100);
    camera.far  = Math.max(1000,  maxDim*10);
    camera.updateProjectionMatrix();
    controls.update();
  }, undefined, (err) => {
    console.error('GLB load error:', err);
  });

  // 리사이즈 & 루프
  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
  (function tick(){
    controls.update();
    renderer.render(scene, camera);
    requestAnimationFrame(tick);
  })();
</script>
</body>
</html>
